
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/2.6.2/phaser.min.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {
	var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'phaser-example', { preload: preload, create: create, update: update });
	var bmd;
	var isDay = true;
	var dayColor = "#7FEEFF";
	var nightColor = "#3a3f3f";
	var rainColor = "#a8b5b3";
	var rainChance = 0.3342; // I got this number from Google. 122/365 (number for NYC)

	class Plant {
		constructor(sprite, x, y, health, age, game) {
			this.sprite = sprite;
			this.health = health
			this.age = age;
			this.game = game;

			this.sprite = this.game.add.sprite(x, y, sprite);
			this.sprite.scale.setTo(0.45, 0.45);
		}

		sprout() {
		}

		getHealth() {
			return this.health;
		}

		getAge() {
			return this.age;
		}

		incrementAge() {
			// TODO: make the plant taller
			this.age +=1;
		}

		inflictDamage(amount) {
			// TODO: change overlay color depending on buckets of 1-5
			this.health -= amount;
		}
	}
	

	function preload() {
		game.load.image('tile_earth', 'assets/img/tile_earth.png');
		game.load.image('seed_acorn', 'assets/img/seed.png');
        game.load.image('seed_sunflower', 'assets/img/seed_sunflower.png');
        game.load.image('image_wateringcan', 'assets/img/image_wateringcan.png')
		game.load.image('plant', 'assets/img/plant.png');
		game.load.image('tile_earth', 'assets/img/tile_earth.png');
		game.load.image('image_toolbar', 'assets/img/toolbar.png');
		game.load.image('sun', 'assets/img/sun.png');
		game.load.image('cloudy', 'assets/img/cloudy.png');
		game.load.image('rain_cloud','assets/img/rain_cloud.png');
		game.load.image('sun_cloud','assets/img/sun_cloud.png');
		game.load.image('moon', 'assets/img/moon.png');
		game.load.image('raindrop', 'assets/img/raindrop.png');
	}

	var toolbar;
	var seed_sunflower;
	var seed_acorn;
	var wateringcan;
	var sunCloudSprite;
	var plant;
	var emitter;
	var isRaining;

	function create() {
        // Add the sky
		addSun();
		game.stage.backgroundColor = dayColor;

        // Tile ground
		ground = [];
		for (var i = 0; i <= 600; i += 200) {
			ground += game.add.tileSprite(i, 425, 200, 175, 'tile_earth');
		}


        // Add toolbar and tool sprites
		toolbar = game.add.image(0, 39, 'image_toolbar');
        seed_sunflower = game.add.sprite(40, 64, 'seed_sunflower');
        seed_acorn = game.add.sprite(40, 212, 'seed_acorn');
        seed_acorn.scale.setTo(0.05,0.05);
        wateringcan = game.add.sprite(19, 138, 'image_wateringcan');


        // Add click and drag mechanics to tools
        seed_sunflower.inputEnabled = true;
        seed_sunflower.input.enableDrag(true);
		seed_sunflower.events.onDragStop.add(stopDrag, this)

        seed_acorn.inputEnabled = true;
        seed_acorn.input.enableDrag(true);
		seed_acorn.events.onDragStop.add(stopDrag, this)

        wateringcan.inputEnabled = true;
        wateringcan.input.enableDrag(true);
		wateringcan.events.onDragStop.add(stopDrag, this)

        //Draw bitmaps and do required stuff that I dont understand
		bmd = game.make.bitmapData();
		bmd.load('tile_earth').cls();
		bmd.addToWorld(game.world.centerX, game.world.centerY, 0.5, 0.5, 2, 2);
		game.stage.smoothed = false;

		game.time.events.repeat(Phaser.Timer.SECOND * 10, 10000, toggleDay, this);
	}

	function toggleDay() {
		isDay = !isDay;
		if(isDay) {
			// TODO: Stop day time activities
			hideSprite(moonSprite);
			if(Math.random() < rainChance) { // raining
				game.stage.backgroundColor = rainColor;
				addSunCloud();
				makeRain();
			} else { // sunny
				game.stage.backgroundColor = dayColor;
				stopRain();
				addSun();
			}
		} else {
			// TODO: Start night time attacks!
			game.stage.backgroundColor = nightColor;
			addMoon();
			hideSprite(sunCloudSprite);
			hideSprite(sunSprite);
			stopRain();
		}

	}

	function stopDrag(sprite, game) {
		// TODO: Trigger the action?
		if(sprite.key === "seed_sunflower") {
			plant = new Plant('plant', sprite.x, 250, 100, 1, this);
			sprite.x = 40
			sprite.y = 64;
			// Seed drops and the plant grows after
		} else if (sprite.key === "seed_acorn") {
			plant = new Plant('plant', sprite.x, 250, 100, 1, this);
			sprite.x = 40
			sprite.y = 212;
			// Seed drops and the plant grows after
		} else if (sprite.key === "image_wateringcan") {
			sprite.x = 19;
			sprite.y = 138;
		}

	}

	// ----- BEGIN BUTTON FUNCTIONS -----
	function placeSeed() {
		addSeed();
		// TODO:
	}
	// ----- END BUTTON FUNCTIONS -----

	function addPlant() {
		plantSprite = game.add.sprite(50, 50, 'plant'),
		plantSprite.scale.setTo(0.05,0.05);
	}

	// NOTE: Do we even need this?
	function plantSeed() {
		if(plantSprite) {
			plantSprite.visible = false;
		}
	}

	function addSeed() {
		seedSprite = game.add.sprite(50, 50, 'seed'),
		seedSprite.scale.setTo(0.05,0.05);
	}

	function addSun(){
		sunSprite = game.add.sprite(600, 25, 'sun');
		sunSprite.scale.setTo(0.5,0.5);
		//sunSprite.frame = 0;
	}

	function addSunCloud(){
		sunCloudSprite = game.add.sprite(600,25,'sun_cloud');
		sunCloudSprite.scale.setTo(0.5,0.5);
	}


	function addRainCloud(){
		rainCloudSprite = game.add.sprite(600,25, 'rain_cloud');
		rainCloudSprite.scale.setTo(0.5,0.5);
	}

	function addCloudy(){
		cloudySprite = game.add.sprite(600,25, 'cloudy');
		cloudySprite.scale.setTo(0.5,0.5);
	}

	function addMoon(){
		moonSprite = game.add.sprite(600,0, 'moon');
		moonSprite.scale.setTo(0.8,0.8);
	}


	function hideSprite(s) {
		if(s) {
			s.visible = false;
		}
	}

	function makeRain(){

		isRaining = true;
		game.physics.startSystem(Phaser.Physics.ARCADE);

		emitter = game.add.emitter(game.world.centerX, 0, 200);
		emitter.width = game.world.width;
		// emitter.angle = 30; // uncomment to set an angle for the rain.

		emitter.makeParticles('raindrop');

		emitter.minParticleScale = 0.1;
		emitter.maxParticleScale = 0.5;

		emitter.setYSpeed(300, 500);
		emitter.setXSpeed(-5, 5);

		emitter.minRotation = 0;
		emitter.maxRotation = 0;

		emitter.start(false, 5000, 10, 400);

		//checkBounds(emitter);
		//emitter.forEachAlive(checkBounds(), this);
	}

	function stopRain(){
		if (isRaining){
			emitter.on = false;
			isRaining = false;
		}
	}

/*
	function checkBounds(thing) {
    	if (thing.y > 600){
        	thing.kill();
        }
    }
    */

	function makeClouds(){

	}

	function update () {
	}

    };

    </script>
    
    </body>
</html>
